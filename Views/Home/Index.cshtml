@{
  ViewData["Title"] = "蹊モンガ";
}

<style>
  .centered-container { display: flex; justify-content: center; align-items: center; height: calc(95vh - 120px); }
  .fade-in { opacity: 0; transition: opacity 1s ease-in-out; }
  .fade-in.visible { opacity: 1; }
  .section-container { margin: 100px 0; }
  .fade-in-img-wrapper { overflow: hidden; height: 100%; position: relative; }
  .fade-in-img { width: 100%; height: auto; transform: translateX(200%) scale(2); transition: transform 1.5s ease-in-out; }
  .fade-in-img-wrapper.visible .fade-in-img { transform: translateX(0) scale(1); }
  .fade-in-img-left { transform: translateX(-200%) scale(2); }
  .fade-in-img-wrapper.visible .fade-in-img-left { transform: translateX(0) scale(1); }
  .wave-text span { display: inline-block; opacity: 0; position: relative; }
  .circle-container { position: relative; width: 250px; height: 250px; margin: auto; }
  .circle { position: absolute; top: 0; left: 0; }
  .hidden-img { display: none; position: absolute; top: 0; left: 0; }
</style>

<div class="container centered-container text-center fade-in">
  <div class="content">
    <h1 class="wave-text" id="title">@ViewData["Title"]</h1>
    <div class="circle-container">
      <svg width="250" height="250" viewBox="0 0 250 250" class="circle">
        <circle cx="125" cy="125" r="120" stroke="black" stroke-width="2" fill="none" stroke-dasharray="0, 753" id="circle-animation"></circle>
      </svg>
      <img src="https://www.pokemon.com/static-assets/content-assets/cms2/img/pokedex/full/587.png" class="img-fluid hidden-img" alt="エモンガ" width="250px" id="emolga-img">
    </div>

    <p class="mt-4 wave-text" id="description">
      "ポケモンの魅力を伝えたい"<br>
      成蹊大学ポケモンサークルの公式ホームページです。
    </p>
  </div>
</div>

<div class="container section-container fade-in">
  <a class="row align-items-center text-light" asp-area="" asp-controller="Home" asp-action="About">
    <div class="col-md-6 text-center">
      <h2 class="wave-text" id="about">サークルについて</h2>
    </div>
    <div class="col-md-6 text-center fade-in-img-wrapper">
      <img src="https://horizons.pokemon.com/_images/home/gallery/hz-gallery-img-11-2x.jpg" class="img-fluid fade-in-img" alt="サークルについて">
    </div>
  </a>
</div>

<div class="container section-container fade-in">
  <a class="row align-items-center flex-row-reverse text-light" asp-area="" asp-controller="Home" asp-action="Active">
    <div class="col-md-6 text-center">
      <h2 class="wave-text" id="activity">活動記録</h2>
    </div>
    <div class="col-md-6 text-center fade-in-img-wrapper">
      <img src="https://horizons.pokemon.com/_images/home/gallery/hz-gallery-img-10-2x.jpg" class="img-fluid fade-in-img fade-in-img-left" alt="活動記録">
    </div>
  </a>
</div>

<div class="container section-container fade-in">
  <a class="row align-items-center text-light" asp-area="" asp-controller="Home" asp-action="Contact">
    <div class="col-md-6 text-center">
      <h2 class="wave-text" id="contact">お問い合わせ</h2>
    </div>
    <div class="col-md-6 text-center fade-in-img-wrapper">
      <img src="https://horizons.pokemon.com/_images/home/gallery/hz-gallery-img-1-2x.jpg" class="img-fluid fade-in-img" alt="お問い合わせ">
    </div>
  </a>
</div>

@section Scripts {
  <script>
    $(document).ready(function() {
      var interval;
      var totalLength = 754;
      var duration = 1500;

      function checkVisibility() {
        $('.fade-in').each(function() {
          var elementTop = $(this).offset().top;
          var elementBottom = elementTop + $(this).outerHeight();
          var viewportTop = $(window).scrollTop();
          var viewportBottom = viewportTop + $(window).height();

          if (elementBottom > viewportTop && elementTop < viewportBottom) {
            $(this).addClass('visible');
          } else {
            $(this).removeClass('visible');
          }
        });

        $('.fade-in-img-wrapper').each(function() {
          var elementTop = $(this).offset().top;
          var elementBottom = elementTop + $(this).outerHeight();
          var viewportTop = $(window).scrollTop();
          var viewportBottom = viewportTop + $(window).height();

          if (elementBottom > viewportTop && elementTop < viewportBottom) {
            $(this).addClass('visible');
          } else {
            $(this).removeClass('visible');
          }
        });

        $('.wave-text').each(function() {
          var elementTop = $(this).offset().top;
          var elementBottom = elementTop + $(this).outerHeight();
          var viewportTop = $(window).scrollTop();
          var viewportBottom = viewportTop + $(window).height();

          if (elementBottom > viewportTop && elementTop < viewportBottom) {
            if (!$(this).hasClass('animated')) {
              applyWaveEffect($(this));
              $(this).addClass('animated');
            }
          } else {
            $(this).removeClass('animated');
            resetWaveEffect($(this));
          }
        });

        var circleContainer = $('.circle-container');
        var circleContainerTop = circleContainer.offset().top;
        var circleContainerBottom = circleContainerTop + circleContainer.outerHeight();
        var viewportTop = $(window).scrollTop();
        var viewportBottom = viewportTop + $(window).height();

        if (circleContainerBottom > viewportTop && circleContainerTop < viewportBottom) {
          if (!circleContainer.hasClass('animated')) {
            drawCircle();
            circleContainer.addClass('animated');
          }
        } else {
          $('#circle-animation').css('stroke-dasharray', '0, 754');
          $('#emolga-img').hide();
          clearInterval(interval);
          circleContainer.removeClass('animated');
        }
      }

      function applyWaveEffect(element) {
        var text = element.text();
        element.html('');
        for (var i = 0; i < text.length; i++) {
          element.append('<span>' + text.charAt(i) + '</span>');
        }

        element.find('span').each(function(index) {
          $(this).delay(index * 100).animate({
            opacity: 1,
            top: '-=10px'
          }, 300).animate({
            top: '+=12px'
          }, 300).animate({
            top: '-=2px'
          }, 300);
        });
      }

      function resetWaveEffect(element) {
        element.find('span').stop(true, true).css({ opacity: 0, top: '0px' });
        element.html(element.text());
      }

      function easeInOutCubic(t) {
        return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
      }

      function drawCircle() {
        var startTime = null;

        function animateCircle(timestamp) {
          if (!startTime) startTime = timestamp;
          var progress = (timestamp - startTime) / duration;
          var easedProgress = easeInOutCubic(progress);

          var length = easedProgress * totalLength;
          $('#circle-animation').css('stroke-dasharray', length + ', ' + totalLength);

          if (progress < 1) {
            requestAnimationFrame(animateCircle);
          } else {
            $('#circle-animation').css('stroke-dasharray', '0, ' + totalLength);
            $('#emolga-img').fadeIn();
          }
        }

        requestAnimationFrame(animateCircle);
      }

      $(window).on('scroll resize', function() {
        checkVisibility();
      });

      checkVisibility();
    });
  </script>
}
